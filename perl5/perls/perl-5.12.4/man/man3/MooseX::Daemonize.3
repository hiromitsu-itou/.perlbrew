.\" Automatically generated by Pod::Man 2.23 (Pod::Simple 3.14)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.ie \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.el \{\
.    de IX
..
.\}
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "MooseX::Daemonize 3"
.TH MooseX::Daemonize 3 "2011-07-06" "perl v5.12.4" "User Contributed Perl Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
MooseX::Daemonize \- Role for daemonizing your Moose based application
.SH "VERSION"
.IX Header "VERSION"
This document describes MooseX::Daemonize version 0.05
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
.Vb 2
\&    package My::Daemon;
\&    use Moose;
\&
\&    with qw(MooseX::Daemonize);
\&
\&    # ... define your class ....
\&
\&    after start => sub {
\&        my $self = shift;
\&        return unless $self\->is_daemon;
\&        # your daemon code here ...
\&    };
\&
\&    # then in your script ...
\&
\&    my $daemon = My::Daemon\->new_with_options();
\&
\&    my ($command) = @{$daemon\->extra_argv}
\&    defined $command || die "No command specified";
\&
\&    $daemon\->start   if $command eq \*(Aqstart\*(Aq;
\&    $daemon\->status  if $command eq \*(Aqstatus\*(Aq;
\&    $daemon\->restart if $command eq \*(Aqrestart\*(Aq;
\&    $daemon\->stop    if $command eq \*(Aqstop\*(Aq;
\&
\&    warn($daemon\->status_message);
\&    exit($daemon\->exit_code);
.Ve
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
Often you want to write a persistant daemon that has a pid file, and responds
appropriately to Signals. This module provides a set of basic roles as an
infrastructure to do that.
.SH "CAVEATS"
.IX Header "CAVEATS"
When going into background MooseX::Daemonize closes all open file
handles. This may interfere with you logging because it may also close the log
file handle you want to write to. To prevent this you can either defer opening
the log file until after start. Alternatively, use can use the
\&'dont_close_all_files' option either from the command line or in your .sh
script.
.PP
Assuming you want to use Log::Log4perl for example you could expand the
MooseX::Daemonize example above like this.
.PP
.Vb 8
\&    after start => sub {
\&        my $self = shift;
\&        return unless $self\->is_daemon;
\&        Log::Log4perl\->init(\e$log4perl_config);
\&        my $logger = Log::Log4perl\->get_logger();
\&        $logger\->info("Daemon started");
\&        # your daemon code here ...
\&    };
.Ve
.SH "ATTRIBUTES"
.IX Header "ATTRIBUTES"
This list includes attributes brought in from other roles as well
we include them here for ease of documentation. All of these attributes
are settable though MooseX::Getopt's command line handling, with the
exception of \f(CW\*(C`is_daemon\*(C'\fR.
.IP "\fIprogname Path::Class::Dir | Str\fR" 4
.IX Item "progname Path::Class::Dir | Str"
The name of our daemon, defaults to \f(CW\*(C`$package_name =~ s/::/_/\*(C'\fR;
.IP "\fIpidbase Path::Class::Dir | Str\fR" 4
.IX Item "pidbase Path::Class::Dir | Str"
The base for our \s-1PID\s0, defaults to \f(CW\*(C`/var/run/\*(C'\fR
.IP "\fIpidfile MooseX::Daemonize::Pid::File | Str\fR" 4
.IX Item "pidfile MooseX::Daemonize::Pid::File | Str"
The file we store our \s-1PID\s0 in, defaults to \f(CW\*(C`$pidbase/$progname.pid\*(C'\fR
.IP "\fIforeground Bool\fR" 4
.IX Item "foreground Bool"
If true, the process won't background. Useful for debugging. This option can
be set via Getopt's \-f.
.IP "\fIno_double_fork Bool\fR" 4
.IX Item "no_double_fork Bool"
If true, the process will not perform the typical double-fork, which is extra
added protection from your process accidentally aquiring a controlling terminal.
More information can be found by Googling \*(L"double fork daemonize\*(R".
.IP "\fIignore_zombies Bool\fR" 4
.IX Item "ignore_zombies Bool"
If true, the process will not clean up zombie processes.
Normally you don't want this.
.IP "\fIdont_close_all_files Bool\fR" 4
.IX Item "dont_close_all_files Bool"
If true, the objects open filehandles will not be closed when daemonized.
Normally you don't want this.
.IP "\fIis_daemon Bool\fR" 4
.IX Item "is_daemon Bool"
If true, the process is the backgrounded daemon process, if false it is the
parent process. This is useful for example in an \f(CW\*(C`after \*(Aqstart\*(Aq =\*(C'\fR sub { }>
block.
.Sp
\&\fB\s-1NOTE:\s0\fR This option is explicitly \fBnot\fR available through MooseX::Getopt.
.IP "\fIstop_timeout\fR" 4
.IX Item "stop_timeout"
Number of seconds to wait for the process to stop, before trying harder to kill
it. Defaults to 2 seconds.
.PP
These are the internal attributes, which are not available through MooseX::Getopt.
.IP "\fIexit_code Int\fR" 4
.IX Item "exit_code Int"
.PD 0
.IP "\fIstatus_message Str\fR" 4
.IX Item "status_message Str"
.PD
.SH "METHODS"
.IX Header "METHODS"
.SS "Daemon Control Methods"
.IX Subsection "Daemon Control Methods"
These methods can be used to control the daemon behavior. Every effort
has been made to have these methods \s-1DWIM\s0 (Do What I Mean), so that you
can focus on just writing the code for your daemon.
.PP
Extending these methods is best done with the Moose method modifiers,
such as \f(CW\*(C`before\*(C'\fR, \f(CW\*(C`after\*(C'\fR and \f(CW\*(C`around\*(C'\fR.
.IP "\fBstart\fR" 4
.IX Item "start"
Setup a pidfile, fork, then setup the signal handlers.
.IP "\fBstop\fR" 4
.IX Item "stop"
Stop the process matching the pidfile, and unlinks the pidfile.
.IP "\fBrestart\fR" 4
.IX Item "restart"
Literally this is:
.Sp
.Vb 2
\&    $self\->stop();
\&    $self\->start();
.Ve
.IP "\fBstatus\fR" 4
.IX Item "status"
.PD 0
.IP "\fBshutdown\fR" 4
.IX Item "shutdown"
.PD
.SS "Pidfile Handling Methods"
.IX Subsection "Pidfile Handling Methods"
.IP "\fBinit_pidfile\fR" 4
.IX Item "init_pidfile"
This method will create a MooseX::Daemonize::Pid::File object and tell
it to store the \s-1PID\s0 in the file \f(CW\*(C`$pidbase/$progname.pid\*(C'\fR.
.IP "\fBcheck\fR" 4
.IX Item "check"
This checks to see if the daemon process is currently running by checking
the pidfile.
.IP "\fBget_pid\fR" 4
.IX Item "get_pid"
Returns the \s-1PID\s0 of the daemon process.
.IP "\fBsave_pid\fR" 4
.IX Item "save_pid"
Write the pidfile.
.IP "\fBremove_pid\fR" 4
.IX Item "remove_pid"
Removes the pidfile.
.SS "Signal Handling Methods"
.IX Subsection "Signal Handling Methods"
.IP "\fBsetup_signals\fR" 4
.IX Item "setup_signals"
Setup the signal handlers, by default it only sets up handlers for \s-1SIGINT\s0 and
\&\s-1SIGHUP\s0. If you wish to add more signals just use the \f(CW\*(C`after\*(C'\fR method modifier
and add them.
.IP "\fBhandle_sigint\fR" 4
.IX Item "handle_sigint"
Handle a \s-1INT\s0 signal, by default calls \f(CW\*(C`$self\-\*(C'\fR\fIstop()\fR>
.IP "\fBhandle_sighup\fR" 4
.IX Item "handle_sighup"
Handle a \s-1HUP\s0 signal. By default calls \f(CW\*(C`$self\-\*(C'\fR\fIrestart()\fR>
.SS "Exit Code Methods"
.IX Subsection "Exit Code Methods"
These are overriable constant methods used for setting the exit code.
.IP "\s-1OK\s0" 4
.IX Item "OK"
Returns 0.
.IP "\s-1ERROR\s0" 4
.IX Item "ERROR"
Returns 1.
.SS "Introspection"
.IX Subsection "Introspection"
.IP "\fImeta()\fR" 4
.IX Item "meta()"
The \f(CW\*(C`meta()\*(C'\fR method from Class::MOP::Class
.SH "DEPENDENCIES"
.IX Header "DEPENDENCIES"
Moose, MooseX::Getopt, MooseX::Types::Path::Class and \s-1POSIX\s0
.SH "INCOMPATIBILITIES"
.IX Header "INCOMPATIBILITIES"
None reported. Although obviously this will not work on Windows.
.SH "BUGS AND LIMITATIONS"
.IX Header "BUGS AND LIMITATIONS"
No bugs have been reported.
.PP
Please report any bugs or feature requests to
\&\f(CW\*(C`bug\-acme\-dahut\-call@rt.cpan.org\*(C'\fR, or through the web interface at
<http://rt.cpan.org>.
.SH "SEE ALSO"
.IX Header "SEE ALSO"
Proc::Daemon, Daemon::Generic
.SH "AUTHORS"
.IX Header "AUTHORS"
Chris Prather  \f(CW\*(C`<chris@prather.org\*(C'\fR
.PP
Stevan Little  \f(CW\*(C`<stevan.little@iinteractive.com>\*(C'\fR
.SH "THANKS"
.IX Header "THANKS"
Mike Boyko, Matt S. Trout, Stevan Little, Brandon Black, Ash Berlin and the
#moose denzians
.PP
Some bug fixes sponsored by Takkle Inc.
.SH "LICENCE AND COPYRIGHT"
.IX Header "LICENCE AND COPYRIGHT"
Copyright (c) 2007\-2011, Chris Prather \f(CW\*(C`<chris@prather.org>\*(C'\fR. Some rights
reserved.
.PP
This module is free software; you can redistribute it and/or
modify it under the same terms as Perl itself. See perlartistic.
.SH "DISCLAIMER OF WARRANTY"
.IX Header "DISCLAIMER OF WARRANTY"
\&\s-1BECAUSE\s0 \s-1THIS\s0 \s-1SOFTWARE\s0 \s-1IS\s0 \s-1LICENSED\s0 \s-1FREE\s0 \s-1OF\s0 \s-1CHARGE\s0, \s-1THERE\s0 \s-1IS\s0 \s-1NO\s0 \s-1WARRANTY\s0
\&\s-1FOR\s0 \s-1THE\s0 \s-1SOFTWARE\s0, \s-1TO\s0 \s-1THE\s0 \s-1EXTENT\s0 \s-1PERMITTED\s0 \s-1BY\s0 \s-1APPLICABLE\s0 \s-1LAW\s0. \s-1EXCEPT\s0 \s-1WHEN\s0
\&\s-1OTHERWISE\s0 \s-1STATED\s0 \s-1IN\s0 \s-1WRITING\s0 \s-1THE\s0 \s-1COPYRIGHT\s0 \s-1HOLDERS\s0 \s-1AND/OR\s0 \s-1OTHER\s0 \s-1PARTIES\s0
\&\s-1PROVIDE\s0 \s-1THE\s0 \s-1SOFTWARE\s0 \*(L"\s-1AS\s0 \s-1IS\s0\*(R" \s-1WITHOUT\s0 \s-1WARRANTY\s0 \s-1OF\s0 \s-1ANY\s0 \s-1KIND\s0, \s-1EITHER\s0
\&\s-1EXPRESSED\s0 \s-1OR\s0 \s-1IMPLIED\s0, \s-1INCLUDING\s0, \s-1BUT\s0 \s-1NOT\s0 \s-1LIMITED\s0 \s-1TO\s0, \s-1THE\s0 \s-1IMPLIED\s0
\&\s-1WARRANTIES\s0 \s-1OF\s0 \s-1MERCHANTABILITY\s0 \s-1AND\s0 \s-1FITNESS\s0 \s-1FOR\s0 A \s-1PARTICULAR\s0 \s-1PURPOSE\s0. \s-1THE\s0
\&\s-1ENTIRE\s0 \s-1RISK\s0 \s-1AS\s0 \s-1TO\s0 \s-1THE\s0 \s-1QUALITY\s0 \s-1AND\s0 \s-1PERFORMANCE\s0 \s-1OF\s0 \s-1THE\s0 \s-1SOFTWARE\s0 \s-1IS\s0 \s-1WITH\s0
\&\s-1YOU\s0. \s-1SHOULD\s0 \s-1THE\s0 \s-1SOFTWARE\s0 \s-1PROVE\s0 \s-1DEFECTIVE\s0, \s-1YOU\s0 \s-1ASSUME\s0 \s-1THE\s0 \s-1COST\s0 \s-1OF\s0 \s-1ALL\s0
\&\s-1NECESSARY\s0 \s-1SERVICING\s0, \s-1REPAIR\s0, \s-1OR\s0 \s-1CORRECTION\s0.
.PP
\&\s-1IN\s0 \s-1NO\s0 \s-1EVENT\s0 \s-1UNLESS\s0 \s-1REQUIRED\s0 \s-1BY\s0 \s-1APPLICABLE\s0 \s-1LAW\s0 \s-1OR\s0 \s-1AGREED\s0 \s-1TO\s0 \s-1IN\s0 \s-1WRITING\s0
\&\s-1WILL\s0 \s-1ANY\s0 \s-1COPYRIGHT\s0 \s-1HOLDER\s0, \s-1OR\s0 \s-1ANY\s0 \s-1OTHER\s0 \s-1PARTY\s0 \s-1WHO\s0 \s-1MAY\s0 \s-1MODIFY\s0 \s-1AND/OR\s0
\&\s-1REDISTRIBUTE\s0 \s-1THE\s0 \s-1SOFTWARE\s0 \s-1AS\s0 \s-1PERMITTED\s0 \s-1BY\s0 \s-1THE\s0 \s-1ABOVE\s0 \s-1LICENCE\s0, \s-1BE\s0
\&\s-1LIABLE\s0 \s-1TO\s0 \s-1YOU\s0 \s-1FOR\s0 \s-1DAMAGES\s0, \s-1INCLUDING\s0 \s-1ANY\s0 \s-1GENERAL\s0, \s-1SPECIAL\s0, \s-1INCIDENTAL\s0,
\&\s-1OR\s0 \s-1CONSEQUENTIAL\s0 \s-1DAMAGES\s0 \s-1ARISING\s0 \s-1OUT\s0 \s-1OF\s0 \s-1THE\s0 \s-1USE\s0 \s-1OR\s0 \s-1INABILITY\s0 \s-1TO\s0 \s-1USE\s0
\&\s-1THE\s0 \s-1SOFTWARE\s0 (\s-1INCLUDING\s0 \s-1BUT\s0 \s-1NOT\s0 \s-1LIMITED\s0 \s-1TO\s0 \s-1LOSS\s0 \s-1OF\s0 \s-1DATA\s0 \s-1OR\s0 \s-1DATA\s0 \s-1BEING\s0
\&\s-1RENDERED\s0 \s-1INACCURATE\s0 \s-1OR\s0 \s-1LOSSES\s0 \s-1SUSTAINED\s0 \s-1BY\s0 \s-1YOU\s0 \s-1OR\s0 \s-1THIRD\s0 \s-1PARTIES\s0 \s-1OR\s0 A
\&\s-1FAILURE\s0 \s-1OF\s0 \s-1THE\s0 \s-1SOFTWARE\s0 \s-1TO\s0 \s-1OPERATE\s0 \s-1WITH\s0 \s-1ANY\s0 \s-1OTHER\s0 \s-1SOFTWARE\s0), \s-1EVEN\s0 \s-1IF\s0
\&\s-1SUCH\s0 \s-1HOLDER\s0 \s-1OR\s0 \s-1OTHER\s0 \s-1PARTY\s0 \s-1HAS\s0 \s-1BEEN\s0 \s-1ADVISED\s0 \s-1OF\s0 \s-1THE\s0 \s-1POSSIBILITY\s0 \s-1OF\s0
\&\s-1SUCH\s0 \s-1DAMAGES\s0.
